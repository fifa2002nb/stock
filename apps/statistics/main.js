(function(){
    angular.module("ones.statistics", ["ngHighcharts"])
        .config(["$routeProvider", function($routeProvider){
            $routeProvider.when('/statistics/list/test', {
                    template:   '<div class="row"><div class="col-xs-12"><highstock data="stockData"></highstock></div></div>',
                    controller: "StatisticsTestCtl"
                })
            ;
        }])
        .factory("StatisticsTestRes", ["$resource", "ones.config", function($resource, cnf){
            return $resource(cnf.BSU + "statistics/test/:id.json", {}, {'query':  {method:'GET', isArray:false}});
        }])
        .controller("StatisticsTestCtl", ["$scope", "$timeout", "StatisticsTestRes", "$rootScope", 
            function($scope, $timeout, res, $rootScope){
                $scope.fake_stock_data={
                "types":["candlestick", "column"],
                "names":["AAPL", "Volume"],
                "data":
                [
                [1264377600000,202.51,204.70,200.19,203.08,38060686],
                [1264464000000,205.95,213.71,202.58,205.94,66682498],
                [1264550400000,206.85,210.58,199.53,207.88,61520290],
                [1264636800000,204.93,205.50,198.70,199.29,41910768],
                [1264723200000,201.08,202.20,190.25,192.06,44498255],
                [1264982400000,192.37,196.00,191.30,194.73,26781203],
                [1265068800000,195.91,196.32,193.38,195.86,24940759],
                [1265155200000,195.17,200.20,194.42,199.23,21975967],
                [1265241600000,196.73,198.37,191.57,192.05,27058966],
                [1265328000000,192.62,196.00,190.85,195.46,30368050],
                [1265587200000,195.69,197.88,194.00,194.12,17081017],
                [1265673600000,196.42,197.50,194.75,196.19,22603004],
                [1265760000000,195.89,196.60,194.26,195.12,13227174],
                [1265846400000,194.88,199.75,194.06,198.67,19655129],
                [1265932800000,198.11,201.64,195.50,200.38,23409558],
                [1266192000000,null,null,null,200.38,0],
                [1266278400000,201.94,203.69,201.52,203.40,19426823],
                [1266364800000,204.19,204.31,200.86,202.55,15585530],
                [1266451200000,201.63,203.89,200.92,202.93,15100873],
                [1266537600000,201.86,203.20,201.11,201.67,14847638],
                [1266796800000,202.34,202.50,199.19,200.42,13958024],
                [1266883200000,200.00,201.33,195.71,197.06,20546889],
                [1266969600000,198.23,201.44,197.84,200.66,16448768],
                [1267056000000,197.38,202.86,196.89,202.00,23764153],
                [1267142400000,202.38,205.17,202.00,204.62,18123580],
                [1267401600000,205.75,209.50,205.45,208.99,19646169],
                [1267488000000,209.93,210.83,207.74,208.85,20233736],
                [1267574400000,208.94,209.87,207.94,209.33,13294242],
                [1267660800000,209.28,210.92,208.63,210.71,13072848],
                [1267747200000,214.94,219.70,214.63,218.95,32129229],
                [1268006400000,220.01,220.09,218.25,219.08,15353177],
                [1268092800000,218.31,225.00,217.89,223.02,32866380],
                [1268179200000,223.83,225.48,223.20,224.84,21293449],
                [1268265600000,223.91,225.50,223.32,225.50,14489234],
                [1268352000000,227.37,227.73,225.75,226.60,14868660],
                [1268611200000,225.38,225.50,220.25,223.84,17625013],
                [1268697600000,224.18,224.98,222.51,224.45,15960948],
                [1268784000000,224.90,226.45,223.27,224.12,16105571],
                [1268870400000,224.10,225.00,222.61,224.65,12218159],
                [1268956800000,224.79,225.24,221.23,222.25,19980164],
                [1269216000000,220.47,226.00,220.15,224.75,16300662],
                [1269302400000,225.64,228.78,224.10,228.36,21515311],
                [1269388800000,227.64,230.20,227.51,229.37,21367176],
                [1269475200000,230.92,230.97,226.25,226.65,19402382],
                [1269561600000,228.95,231.95,228.55,230.90,22888305],
                [1269820800000,233.00,233.87,231.62,232.39,19312255],
                [1269907200000,236.60,237.48,234.25,235.84,18832475],
                [1269993600000,235.49,236.61,234.46,235.00,15380651],
                [1270080000000,237.49,238.73,232.75,235.97,21540857],
                [1270166400000,null,null,null,235.97,0],
                [1270425600000,234.98,238.51,234.77,238.49,24446617],
                [1270512000000,238.20,240.24,237.00,239.54,15964884],
                [1270598400000,239.72,241.92,238.66,240.60,22446433],
                [1270684800000,240.44,241.54,238.04,239.95,20463803],
                [1270771200000,241.43,241.89,240.46,241.79,11935092],
                [1271030400000,242.20,243.07,241.81,242.29,11900548],
                [1271116800000,241.86,242.80,241.11,242.43,10936075],
                [1271203200000,245.28,245.81,244.07,245.69,14431222],
                [1271289600000,245.78,249.03,245.51,248.92,13456560],
                [1271376000000,248.57,251.14,244.55,247.40,26805138],
                [1271635200000,247.03,247.89,241.77,247.07,20247213],
                [1271721600000,248.54,249.25,242.96,244.59,26368711],
                [1271808000000,258.80,260.25,255.73,259.22,35085400],
                [1271894400000,258.24,266.75,256.20,266.47,28336545],
                [1271980800000,267.99,272.18,267.00,270.83,28462622]
                ]};
                
                //变量预设
                var startTime = new Date();
                var endTime = new Date();
                startTime.setMonth(startTime.getMonth()-1);
                $scope.filterFormData = $scope.filterFormData || {};
                $scope.filterFormData._filter_start_dateline = startTime;
                $scope.filterFormData._filter_end_dateline = endTime;
                $scope.filterFormData._filter_timeStep = 60;

                $scope.stockData = [];
                $scope.options = {};

                var doQuery = function () {
                    res.query($scope.filterFormData).$promise.then(function(data){
                        $scope.stockData = data;
                    });
                };
                doQuery();
                //$scope.stockData = $scope.fake_stock_data;
        }])
    ;
})();
